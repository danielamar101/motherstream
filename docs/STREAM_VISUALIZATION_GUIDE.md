# Stream Buffer & Attribute Visualization Guide

## ðŸŽ¯ Overview

This guide covers all the ways to visualize stream buffers, performance metrics, and system attributes in real-time and historically.

## ðŸ“Š Visualization Tools Available

### 1. **Real-Time Terminal Dashboard** (`stream_dashboard.py`) â­ NEW

**What it shows:**
- Live OBS output performance (FPS, encoding skip rate, frame time)
- System resources (CPU, Memory, Network bandwidth)
- Buffer pressure visualization
- Sparklines for historical trends
- Color-coded health indicators

**Perfect for:**
- Quick health checks
- Terminal-only environments
- Low-resource monitoring
- SSH sessions

**Usage:**
```bash
cd /home/motherstream/Desktop/motherstream/scripts
./stream_dashboard.py
```

**Screenshot (terminal UI):**
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        ðŸŽ¥ MOTHERSTREAM - Real-Time Dashboard
                               2025-11-14 10:45:23
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“Š OBS OUTPUT PERFORMANCE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Status: ðŸ”´ LIVE (01:23:45)

âœ… FPS:  29.8      â–â–‚â–ƒâ–„â–…â–…â–†â–†â–‡â–‡â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‡â–‡â–†
âš ï¸  Frame Time:  42.3ms  (target: 33ms)
âœ… Encoding Skip:  0.2 fps      â–â–â–â–â–â–â–‚â–â–â–â–â–â–â–â–â–â–â–â–

   Render Skipped: 234 (0.01%)
   Output Skipped: 89 (0.02%)

ðŸ’» SYSTEM RESOURCES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… CPU:  68.3%   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â–ƒâ–„â–…â–†â–‡â–‡â–‡â–†â–…â–„
âš ï¸  Memory: 82.1%   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘
ðŸ“¡ Upload:  125.50 Mbps      â–„â–…â–†â–‡â–ˆâ–ˆâ–ˆâ–ˆâ–‡â–†â–…â–„â–ƒâ–‚

ðŸ“¦ STREAM BUFFERS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Render Pipeline: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 75%
Encoding Queue:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 25%
```

### 2. **Web-Based Dashboard** (`web_dashboard.html`) â­ NEW

**What it shows:**
- Beautiful real-time graphs
- Animated buffer visualizations
- Historical trend charts
- Color-coded alerts
- Responsive design

**Perfect for:**
- Visual monitoring
- Executive dashboards
- Multi-screen setups
- Remote monitoring

**Usage:**
```bash
# Open in browser
open /home/motherstream/Desktop/motherstream/scripts/web_dashboard.html
# or
firefox /home/motherstream/Desktop/motherstream/scripts/web_dashboard.html
```

**Features:**
- ðŸ“ˆ Real-time line charts (FPS, CPU, Memory, Bandwidth)
- ðŸ“Š Progress bars with color coding
- ðŸŽ¨ Animated buffer segments
- ðŸš¨ Auto-alerts for critical issues
- ðŸ“± Responsive layout

### 3. **Historical Data Analysis** (`analyze_monitoring_data.py`)

**What it shows:**
- Statistical analysis of past monitoring sessions
- Matplotlib graphs
- Comparison between multiple tests
- Capacity estimation

**Perfect for:**
- Post-test analysis
- Capacity planning
- Performance tuning
- Comparing configurations

**Usage:**
```bash
# Analyze latest test
./analyze_monitoring_data.py --latest --plot

# Generate PNG report
./analyze_monitoring_data.py --latest --plot --output capacity_report.png

# Compare multiple tests
./analyze_monitoring_data.py --compare ./monitoring-logs/*.csv
```

### 4. **CSV Logs** (Machine-readable)

**Generated by:**
- `network_monitor.py` â†’ `monitoring-logs/network_monitor_*.csv`
- `obs_output_monitor.py` â†’ `obs-output/obs-output-*.csv`
- Stream health monitor â†’ `stream-metrics/stream-health-*.csv`

**Perfect for:**
- Custom analysis
- Importing to spreadsheets
- Data science workflows
- Long-term trending

## ðŸŽ¨ What You Can Visualize

### 1. **Buffer Sizes & States**

#### GStreamer Pipeline Buffers

**Where to see:**
- Web dashboard: Buffer visualization section
- Terminal dashboard: Buffer pressure meters
- Logs: `stream-metrics/*.csv` (media_time progression)

**What it shows:**
- **Render buffer pressure**: How full the rendering pipeline is
- **Encoding buffer pressure**: How backed up the encoder is
- **Buffer states**: Empty â†’ Filling â†’ Full â†’ Overflow

**Visual indicators:**
```
Empty:     â–‘â–‘â–‘â–‘â–‘  (Low load, plenty of capacity)
Filling:   â–ˆâ–ˆâ–ˆâ–‘â–‘  (Normal operation)
Full:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (High load, stable)
Overflow:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ! (Overloaded, skipping frames)
```

**Note:** Individual GStreamer source buffer levels are not exposed by OBS WebSocket. The dashboard shows inferred buffer pressure based on performance metrics.

#### How Buffers Map to Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RTMP Input Stream   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† GStreamer Buffer
â”‚  Decode & Process    â”‚    (Not directly visible)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† Render Buffer
â”‚   OBS Rendering      â”‚    Pressure = Frame Time / 50ms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    Visible in dashboard!
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† Encoding Buffer  
â”‚  Video Encoding      â”‚    Pressure = Skip Rate / 10fps
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    Visible in dashboard!
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Output to YouTube   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **Performance Metrics**

#### FPS (Frames Per Second)
- **What it is:** Actual output framerate
- **Target:** 30.0 fps (or your configured rate)
- **Why it matters:** Drops below 28 fps are visible to viewers
- **Visualized as:** 
  - Line chart (historical)
  - Progress bar (current)
  - Sparkline (mini trend)

#### Encoding Skip Rate
- **What it is:** Frames per second being dropped by encoder
- **Target:** 0.0 fps
- **Why it matters:** **THIS IS THE CHOPPINESS INDICATOR**
- **Visualized as:**
  - Line chart with threshold lines
  - Progress bar (red when > 1.0)
  - Alert banners when critical

#### Frame Render Time
- **What it is:** Milliseconds to render each frame
- **Target:** ~33ms (for 30 FPS)
- **Why it matters:** Shows if rendering is keeping up
- **Visualized as:**
  - Progress bar
  - Trend line

#### CPU & Memory
- **What it is:** System resource usage
- **Target:** CPU < 80%, Memory < 85%
- **Why it matters:** Bottlenecks cause all issues
- **Visualized as:**
  - Dual-axis chart (CPU & Memory together)
  - Progress bars with color coding
  - Sparklines

#### Network Bandwidth
- **What it is:** Upload speed in Mbps
- **Target:** < 80% of line capacity
- **Why it matters:** Saturation causes packet loss
- **Visualized as:**
  - Line chart
  - Real-time counter

### 3. **Stream Attributes**

#### Media State
- **Values:** PLAYING, BUFFERING, STOPPED, PAUSED, ERROR
- **Where:** Stream health logs
- **Visualized:** Status badge in dashboard

#### Media Time Progression
- **What it is:** Playback position advancing
- **Why it matters:** Stalls indicate buffering
- **Where:** Stream health CSV (`media_time` column)
- **Visualized:** Plot media_time vs timestamp to detect stalls

#### Timestamp Jumps
- **What it is:** Discontinuities in stream timestamps
- **Why it matters:** Causes A/V desync and stuttering
- **Where:** Stream health logs (`issues` column)
- **Visualized:** Scatter plot of delta values

## ðŸš€ Quick Start Guides

### Monitor During Load Test

**Terminal 1: Terminal Dashboard**
```bash
cd /home/motherstream/Desktop/motherstream/scripts
./stream_dashboard.py
```

**Terminal 2: Load Test**
```bash
./stream_load_tester.py --rtmp-url rtmp://localhost/live --max-streams 50
```

**Terminal 3: Web Dashboard**
```bash
# Open in browser
firefox web_dashboard.html
```

### Analyze Past Test

```bash
# View statistics
./analyze_monitoring_data.py --latest

# Generate graphs
./analyze_monitoring_data.py --latest --plot

# Save report
./analyze_monitoring_data.py --latest --plot --output report.png
```

### Compare Performance Changes

```bash
# Before optimization
./network_monitor.py --duration 300 --log-dir ./logs/before

# After optimization  
./network_monitor.py --duration 300 --log-dir ./logs/after

# Compare
./analyze_monitoring_data.py --compare ./logs/before/*.csv ./logs/after/*.csv
```

## ðŸ“ˆ Understanding Buffer Visualizations

### Buffer Segment States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State   â”‚ Visual       â”‚ Meaning    â”‚ Action     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Empty   â”‚ â–‘â–‘â–‘ (gray)   â”‚ 0-20% full â”‚ Normal     â”‚
â”‚ Filling â”‚ â–ˆâ–ˆâ–ˆ (blue)   â”‚ 20-80%     â”‚ Normal     â”‚
â”‚ Full    â”‚ â–ˆâ–ˆâ–ˆ (green)  â”‚ 80-100%    â”‚ Watch      â”‚
â”‚ Overflowâ”‚ â–ˆâ–ˆâ–ˆ (red)    â”‚ > 100%     â”‚ CRITICAL!  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### What Overflow Means

**Render Buffer Overflow:**
```
Cause: Scene too complex or GPU too slow
Effect: Frames take too long to render
Result: Stuttering video output
Solution: Simplify scene or upgrade GPU
```

**Encoding Buffer Overflow:**
```
Cause: CPU cannot keep up with encoding
Effect: Encoder skips frames
Result: CHOPPY VIDEO (the issue you reported!)
Solution: Faster preset, hardware encoding, or upgrade CPU
```

## ðŸŽ¯ Key Visualizations for Choppiness

To diagnose the choppiness you mentioned, focus on these:

### 1. Encoding Skip Rate Chart â­ MOST IMPORTANT
```
Any value > 1.0 fps = Visible choppiness
Any value > 5.0 fps = Very choppy

Terminal Dashboard: Shows as progress bar + sparkline
Web Dashboard: Red line chart with threshold markers
```

### 2. Encoding Buffer Visualization
```
If showing "overflow" state = CPU bottleneck confirmed

Terminal: Red segments with warnings
Web: Animated red segments, shaking effect
```

### 3. FPS Drop Detection
```
Watch for dips below 28 fps

Terminal: Color changes from green to yellow/red
Web: Line chart dips, alert banners
```

### 4. Correlation View (System Chart)
```
Plot CPU, Memory, and Encoding Skip together
See which resource correlates with choppiness

Web Dashboard: Multi-axis chart shows all three
Analyze tool: Can generate correlation plots
```

## ðŸ’¡ Advanced Visualization Tips

### Custom Grafana Dashboard

If you want production-grade monitoring:

```bash
# Export data to Grafana-compatible format
cat monitoring-logs/network_monitor_*.csv | \
  awk -F',' '{print $1","$3","$4","$11","$12}' > grafana_export.csv

# Import to Grafana, set up time-series panels
```

### Python Data Analysis

```python
import pandas as pd
import matplotlib.pyplot as plt

# Load data
df = pd.read_csv('monitoring-logs/network_monitor_20251114-103045.csv')

# Plot encoding skip rate vs concurrent connections
plt.scatter(df['rtmp_connections'], df['encoding_skip_rate'])
plt.xlabel('Concurrent Streams')
plt.ylabel('Encoding Skip Rate (fps)')
plt.title('Capacity Analysis')
plt.axhline(y=1.0, color='r', linestyle='--', label='Choppiness Threshold')
plt.legend()
plt.show()
```

### Real-Time Alerts

```bash
# Monitor encoding skip rate, send alert if > 2.0
while true; do
  skip_rate=$(./check_obs_output_health.py --duration 5 2>&1 | \
    grep "EncSkip" | awk '{print $5}')
  
  if (( $(echo "$skip_rate > 2.0" | bc -l) )); then
    echo "ALERT: Encoding skip rate high: $skip_rate" | \
      mail -s "Stream Quality Alert" admin@example.com
  fi
  
  sleep 60
done
```

## ðŸ“ Where Visualizations Are Saved

```
scripts/
â”œâ”€â”€ stream_dashboard.py        # Terminal UI (run this)
â”œâ”€â”€ web_dashboard.html          # Web UI (open in browser)
â”œâ”€â”€ analyze_monitoring_data.py  # Historical analysis
â””â”€â”€ monitoring-logs/
    â”œâ”€â”€ network_monitor_*.csv   # Raw data
    â”œâ”€â”€ network_summary_*.txt   # Text reports
    â””â”€â”€ *.png                   # Generated plots

app/core/
â””â”€â”€ obs-output/
    â”œâ”€â”€ obs-output-*.csv        # OBS performance logs
    â””â”€â”€ obs-output-report-*.txt # OBS reports

docker-volume-mounts/logs/
â””â”€â”€ stream-metrics/
    â”œâ”€â”€ stream-health-*.csv     # Per-stream health
    â””â”€â”€ stream-health-*-report.txt
```

## ðŸŽ¨ Customizing Visualizations

### Terminal Dashboard Colors

Edit `stream_dashboard.py`, color pairs:
```python
curses.init_pair(1, curses.COLOR_RED, -1)     # Critical
curses.init_pair(2, curses.COLOR_GREEN, -1)   # Good
curses.init_pair(3, curses.COLOR_YELLOW, -1)  # Warning
curses.init_pair(4, curses.COLOR_CYAN, -1)    # Info
```

### Web Dashboard Thresholds

Edit `web_dashboard.html`, JavaScript section:
```javascript
// FPS thresholds
{ warning: 28, critical: 25 }

// Encoding skip rate thresholds
{ warning: 1, critical: 5 }

// CPU thresholds
{ warning: 70, critical: 85 }
```

### Chart Colors

In `analyze_monitoring_data.py`:
```python
# Edit plot_data() function
ax1.plot(df['elapsed_seconds'], df['upload_mbps'], 
         color='#2E86AB', linewidth=2)  # Change color here
```

## ðŸš¨ Critical Indicators to Watch

### For Choppiness Diagnosis:

1. **ðŸ”´ Encoding Skip Rate > 1.0 fps**
   - Terminal: Red progress bar
   - Web: Red line crossing threshold
   - Action: Reduce load or optimize encoding

2. **ðŸŸ¡ FPS < 28**
   - Terminal: Yellow/red FPS display
   - Web: Dip in FPS chart
   - Action: Check CPU and GPU

3. **ðŸŸ¡ Frame Time > 40ms**
   - Terminal: Yellow progress bar
   - Web: Bar approaching 50ms
   - Action: Simplify scene or check GPU

4. **ðŸ”´ CPU > 90%**
   - Terminal: Red CPU bar
   - Web: CPU line in danger zone
   - Action: Reduce concurrent streams

## ðŸ“– Related Documentation

- `HIGH_LOAD_CHOPPINESS_GUIDE.md` - Root cause analysis
- `CHOPPINESS_SOLUTION_SUMMARY.md` - Quick reference
- `CAPACITY_TESTING_GUIDE.md` - Load testing
- `CHOPPINESS-DETECTION.md` - Detection algorithms

## âœ… Summary

**To visualize stream buffers and attributes, use:**

1. **Real-time monitoring:** Terminal dashboard (`stream_dashboard.py`)
2. **Visual monitoring:** Web dashboard (`web_dashboard.html`)
3. **Historical analysis:** Analyze tool (`analyze_monitoring_data.py`)
4. **Custom analysis:** CSV logs with pandas/Excel

**To diagnose choppiness, watch:**
- Encoding skip rate (> 1.0 fps = problem)
- Encoding buffer state (overflow = CPU bottleneck)
- FPS drops (< 28 = visible to viewers)
- CPU correlation (> 90% = overloaded)

**Start now:**
```bash
./stream_dashboard.py  # Launch real-time dashboard
```

---

**Your buffers and performance metrics are now fully visible! ðŸ“Š**

